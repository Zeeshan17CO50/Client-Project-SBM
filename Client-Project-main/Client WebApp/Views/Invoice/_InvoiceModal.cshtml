@model Client_WebApp.Models.AddInvoiceViewModel

<div class="modal fade" id="invoice-modal" tabindex="-1" aria-labelledby="invoiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="invoiceModalLabel">Add Invoice</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form asp-action="CreateOrEdit" method="post" id="invoiceForm">
                @Html.AntiForgeryToken()

                <div class="modal-body">
                    <input asp-for="Id" type="hidden" id="Id" />
                    <input asp-for="CompanyId" type="hidden" id="CompanyId" />

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label asp-for="InvoiceNo" class="form-label"></label>
                            <input asp-for="InvoiceNo" class="form-control" id="InvoiceNo" />
                            <span asp-validation-for="InvoiceNo" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="InvoiceDate" class="form-label"></label>
                            <input asp-for="InvoiceDate" class="form-control" type="date" id="InvoiceDate" />
                            <span asp-validation-for="InvoiceDate" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="SubcontractorId" class="form-label"></label>
                            <select asp-for="SubcontractorId" class="form-select" asp-items="Model.SubContractorList">
                                <option value="">--Select--</option>
                            </select>
                            <span asp-validation-for="SubcontractorId" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="ProductId" class="form-label"></label>
                            <select asp-for="ProductId" class="form-select" asp-items="Model.ProductList" id="ProductId">
                                <option value="">--Select--</option>
                            </select>
                            <span asp-validation-for="ProductId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="UnitAmount" class="form-label"></label>
                            <input asp-for="UnitAmount" class="form-control" id="UnitAmount" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Quantity" class="form-label"></label>
                            <input asp-for="Quantity" class="form-control" id="Quantity" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="TotalAmount" class="form-label"></label>
                            <input asp-for="TotalAmount" class="form-control" id="TotalAmount" readonly />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="CommissionPercentage" class="form-label"></label>
                            <input asp-for="CommissionPercentage" class="form-control" id="CommissionPercentage" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="CommissionAmount" class="form-label"></label>
                            <input asp-for="CommissionAmount" class="form-control" id="CommissionAmount" readonly />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Invoice Type</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" asp-for="PaymentMode" value="CASH" id="invoiceTypeCash" />
                                    <label class="form-check-label" for="invoiceTypeCash">Cash</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" asp-for="PaymentMode" value="BALANCE" id="invoiceTypeBalance" />
                                    <label class="form-check-label" for="invoiceTypeBalance">Balance</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="saveButton">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            $('#invoiceForm').submit(function (e) {
                e.preventDefault();
                var form = $(this);
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    success: function (result) {
                        if (result.success) {
                            $('#invoice-modal').modal('hide');
                            localStorage.setItem('toastMessage', result.message);
                            window.location.href = '/Invoice/Index';

                            location.reload(); // refresh invoice table
                        } else {
                            alert(result.message);
                        }
                    },
                    error: function (err) {
                        console.error(err);
                        alert('Something went wrong');
                    }
                });
            });
        });
    </script>
}
